# HEX

## Описание проекта
HEX — прототип AI try-on платформы для онлайн-ретейла. Сервис поддерживает ссылки на товары с Wildberries, Ozon и Lamoda, выполняет 2D/3D примерку и использует AI для подбора размера и рекомендаций. Текущий статус: ранний прототип в активной разработке.

## Быстрый старт
### Требования
- Node.js 18+
- npm 9+

### Установка
```bash
npm install
```

### Команды
- `npm run dev` — запуск фронтенда в режиме разработки (Vite).
- `npm run server` — запуск API-сервера (Fastify).
- `npm run build` — сборка фронтенда.
- `npm run preview` — предпросмотр собранной версии.

## Технологический стек
- React 18 + Vite
- Tailwind CSS
- Fastify (Node.js)
- AI SDKs/модели для 2D/3D try-on (подключаемые провайдеры)

## Структура проекта
- `src/` — клиентское приложение (страницы, компоненты, хуки, утилиты).
- `server/` — серверная часть (маршруты Fastify, интеграции с AI/маркетплейсами, конфигурация).

### Архитектура адаптеров маркетплейсов
- Все адаптеры живут в `server/services/adapters/` и реализуют общий интерфейс `MarketplaceAdapter` с полями `domains` и `fetchProduct`.
- Реестр адаптеров находится в `server/services/adapters/index.ts`; туда нужно добавлять новые интеграции.
- Парсер `server/productParser.ts` сначала пытается получить данные через адаптер, а при `null` автоматически переходит к HTML‑парсеру.
- Доступные хелперы для переиспользования: `ensureNumber` и `computeDiscount` (нормализация цены/скидки), `extractSizes` (нормализация размеров), `FALLBACK_IMAGES` (дефолтные изображения).

Чтобы добавить новый маркетплейс:
1. Создайте файл адаптера в `server/services/adapters/` и укажите домены в `domains`.
2. Используйте общие хелперы для чисел, скидок и размеров, чтобы результаты совпадали с существующей логикой.
3. Зарегистрируйте адаптер в массиве `marketplaceAdapters` в `server/services/adapters/index.ts`.
4. Добавьте модульные тесты для адаптера по аналогии с `test/services.adapters.wildberries.test.ts`, проверяя скидки и нормализацию размеров.

## API
- `GET /api/product/parse?url=` — парсинг карточки товара и рекомендации размеров.
- `POST /api/tryon/2d` — 2D-примерка по фотографии (multipart, поле `image`).
- `POST /api/tryon/3d` — 3D-примерка по параметрам тела.

Детальное описание параметров, валидаторов, кодов ошибок и примеров запросов см. в [docs/API.md](docs/API.md).

## Ключевые функции UI
- Проверка и валидация ссылок маркетплейсов (WB/Ozon/Lamoda).
- Выбор размеров и отображение доступности/совместимости.
- AI-рекомендации по посадке и стилю на основе 2D/3D примерки.

## Дорожная карта и ограничения прототипа
- **В процессе**: улучшение точности try-on, оптимизация времени отклика, расширение поддерживаемых брендов.
- **Планируется**: личный кабинет с историей примерок, A/B тестирование рекомендаций, аналитика по конверсии.
- **Ограничения**: прототип не предназначен для продакшена; возможны задержки/ошибки AI-сервисов; 3D примерка зависит от качества исходного скана.
