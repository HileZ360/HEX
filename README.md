# HEX — AI try-on платформа для e-commerce

Профессиональный прототип сервиса виртуальной примерки одежды: принимает ссылки с Wildberries/Ozon/Lamoda, парсит карточки, подбирает размеры, выполняет 2D/3D try-on через интегрируемые AI‑провайдеры и отдаёт готовые рекомендации.

## Оглавление
- [Ключевые возможности](#ключевые-возможности)
- [Архитектура и стек](#архитектура-и-стек)
- [Требования](#требования)
- [Установка и запуск](#установка-и-запуск)
- [Переменные окружения](#переменные-окружения)
- [Основные команды](#основные-команды)
- [Структура проекта](#структура-проекта)
- [API](#api)
- [Качество и тестирование](#качество-и-тестирование)
- [Дорожная карта](#дорожная-карта)

## Ключевые возможности
- Приём ссылок маркетплейсов и унифицированный парсер карточек с fallback на HTML-извлечение.
- AI‑подбор размеров и отображение доступности/совместимости.
- 2D try-on по фотографии и 3D примерка по параметрам тела через подключаемых провайдеров.
- Ограничение запросов, кеширование и повторное использование результатов для стабильной работы прототипа.

## Архитектура и стек
- **Фронтенд:** React 18 + Vite, React Router, Tailwind CSS, анимации (Framer Motion/GSAP), локализация через i18next.
- **Сервер:** Fastify, адаптеры маркетплейсов в `server/services/adapters`, нормализаторы данных и ограничения по скорости/очередям.
- **AI-интеграции:** абстрактные провайдеры 2D/3D примерки с авторизацией по токену и конфигурируемыми таймаутами.
- **Тесты:** встроенные unit-тесты на tsx (Node.js test runner).

## Требования
- Node.js 18+
- npm 9+

## Установка и запуск
```bash
npm install              # установка зависимостей
npm run dev              # фронтенд в dev-режиме (Vite)
npm run server           # API-сервер Fastify (порт 4000 по умолчанию)
# Дополнительно
npm run build            # сборка фронтенда
npm run preview          # предпросмотр сборки
```

## Переменные окружения
Минимально обязательные:
- `TRY_ON_API_URL` — базовый endpoint провайдера примерки.
- `TRY_ON_API_TOKEN` — токен авторизации провайдера.

Рекомендуемые/опциональные для точной настройки:
- `TRY_ON_3D_API_URL` — отдельный endpoint для 3D try-on (иначе используется `TRY_ON_API_URL`).
- `TRY_ON_TIMEOUT_MS`, `TRY_ON_PROVIDER_TIMEOUT_MS` — общие таймауты запросов к провайдерам (мс).
- `CATVTON_API_URL`, `CATVTON_API_TOKEN`, `CATVTON_TIMEOUT_MS` — альтернативный провайдер примерки.
- `PREVIEW_*` (например, `PREVIEW_RETENTION_MINUTES`, `PREVIEW_MAX_COUNT`, `PREVIEW_TOKEN_SECRET`) — управление хранением предпросмотров и токенами загрузки.
- `PRODUCT_*` (например, `PRODUCT_RATE_LIMIT_MAX`, `PRODUCT_PARSE_MAX_CONCURRENCY`, `PRODUCT_URL_MAX_LENGTH`) — ограничения очередей и парсинга карточек.
- `PARSED_PRODUCT_TTL_MS`, `PARSED_PRODUCT_CACHE_LIMIT` — кеширование результатов парсинга.
- `PORT` — порт Fastify (по умолчанию 4000).

## Основные команды
- `npm run dev` — фронтенд в режиме разработки.
- `npm run server` — запуск API-сервера.
- `npm run build` — сборка SPA.
- `npm run preview` — предпросмотр прод-сборки.
- `npm test` — unit-тесты (Node.js test runner через tsx).

## Структура проекта
- `src/` — клиентское приложение (страницы, компоненты, хуки, утилиты).
- `server/` — Fastify-сервер, интеграции с маркетплейсами и AI.
  - `server/services/adapters/` — адаптеры маркетплейсов, регистрируются в `index.ts`.
  - `server/parsers/`, `server/normalizers/` — извлечение и нормализация данных карточек.
- `docs/` — сопутствующая документация (например, `API.md`).
- `test/` — модульные тесты (см. пример `test/services.adapters.wildberries.test.ts`).

## API
- `GET /api/product/parse?url=` — парсинг карточки товара и рекомендации размеров.
- `POST /api/tryon/2d` — 2D примерка по фото (multipart, поле `image`).
- `POST /api/tryon/3d` — 3D примерка по параметрам тела.

Детальные параметры, коды ошибок и примеры запросов: [docs/API.md](docs/API.md).

## Качество и тестирование
- Локальный запуск: `npm test`.
- Перед коммитом рекомендуется прогонять сборку (`npm run build`) и проверять базовые сценарии фронтенда/бэкенда с реальными API ключами.
- Таймауты и rate limit'ы выносите в переменные окружения — это облегчает нагрузочное тестирование без правок кода.

## Дорожная карта
- Улучшение точности try-on и скорости отклика.
- Расширение поддержки маркетплейсов и брендов через новые адаптеры.
- Личный кабинет с историей примерок и аналитикой конверсии.
- A/B-тестирование рекомендаций и мониторинг качества в продакшене.
